---
import Layout from "../../../layouts/Layout.astro";
import { languages } from "../../../i18n/ui";
import { projects } from "../../../i18n/content";

export function getStaticPaths() {
    const paths = [];

    Object.keys(languages).forEach((lang) => {
        // @ts-ignore
        projects[lang].forEach((project) => {
            paths.push({
                params: { lang, slug: project.slug },
                props: { project, lang },
            });
        });
    });

    return paths;
}

const { project, lang } = Astro.props;
---

<Layout title={`${project.title} | Portfolio`} lang={lang}>
    <div class="max-w-4xl mx-auto">
        <a
            href={`/${lang}/`}
            class="inline-flex items-center text-gray-400 hover:text-white mb-8 transition-colors group"
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="mr-2 group-hover:-translate-x-1 transition-transform"
                ><path d="m15 18-6-6 6-6"></path></svg
            >
            Back to Projects
        </a>

        <div class="space-y-8">
            <header>
                <div class="flex flex-wrap gap-3 mb-6">
                    {
                        project.tags.map((tag) => (
                            <span class="text-sm font-medium px-3 py-1.5 rounded-full bg-gray-900 border border-gray-700 text-gray-300">
                                {tag}
                            </span>
                        ))
                    }
                </div>
                <h1
                    class="text-4xl md:text-6xl font-bold text-white mb-6 leading-tight"
                >
                    {project.title}
                </h1>
                <p class="text-xl text-gray-400 leading-relaxed">
                    {project.description}
                </p>
            </header>

            {
                project.image && (
                    <div class="rounded-2xl overflow-hidden shadow-2xl border border-gray-800 bg-gray-900">
                        <img
                            src={project.image}
                            alt={project.title}
                            class="w-full h-auto object-cover"
                        />
                    </div>
                )
            }

            <div class="prose prose-invert max-w-none">
                <h3 class="text-2xl font-semibold text-white mb-4">
                    {
                        lang === "pt"
                            ? "Sobre a Funcionalidade"
                            : "About Functionality"
                    }
                </h3>
                <p class="text-gray-300 leading-relaxed">
                    {project.details}
                </p>

                {
                    project.gallery && (
                        <div class="mt-12">
                            <h3 class="text-2xl font-semibold text-white mb-6">
                                {lang === "pt" ? "Galeria" : "Gallery"}
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {project.gallery.map((image) => (
                                    <div
                                        class="rounded-xl overflow-hidden shadow-lg border border-gray-800 bg-gray-900 transition-transform duration-300 hover:scale-[1.02] cursor-pointer"
                                        onclick={`openLightbox('${image}')`}
                                    >
                                        <img
                                            src={image}
                                            alt={`${project.title} gallery image`}
                                            class="w-full h-48 object-cover"
                                        />
                                    </div>
                                ))}
                            </div>
                        </div>
                    )
                }

                <div class="flex gap-4 mt-8">
                    {
                        project.repositories ? (
                            project.repositories.map((repo) => (
                                <a
                                    href={repo.url}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="inline-flex items-center justify-center px-6 py-3 text-base font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 transition-colors"
                                >
                                    {repo.label}
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="20"
                                        height="20"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        class="ml-2"
                                    >
                                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
                                        <polyline points="15 3 21 3 21 9" />
                                        <line x1="10" y1="14" x2="21" y2="3" />
                                    </svg>
                                </a>
                            ))
                        ) : (
                            <a
                                href={project.href}
                                class="inline-flex items-center justify-center px-6 py-3 text-base font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 transition-colors"
                            >
                                View Demo
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    width="20"
                                    height="20"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    class="ml-2"
                                >
                                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
                                    <polyline points="15 3 21 3 21 9" />
                                    <line x1="10" y1="14" x2="21" y2="3" />
                                </svg>
                            </a>
                        )
                    }
                </div>
            </div>
        </div>
    </div>
</Layout>

<!-- Lightbox Modal -->
<div
    id="lightbox"
    class="fixed inset-0 z-50 hidden bg-black/90 flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300 opacity-0"
    onclick="closeLightbox()"
>
    <!-- Close Button -->
    <button
        class="absolute top-4 right-4 text-white/70 hover:text-white transition-colors"
        onclick="closeLightbox()"
    >
        <svg
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-x"
            ><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg
        >
    </button>

    <!-- Image Container -->
    <div
        class="relative max-w-7xl max-h-[90vh] w-full flex items-center justify-center"
    >
        <img
            id="lightbox-img"
            src=""
            alt="Full screen gallery image"
            class="max-h-[90vh] max-w-full rounded-lg shadow-2xl object-contain"
            onclick="event.stopPropagation()"
        />
    </div>
</div>

<script is:inline>
    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById("lightbox-img");

    function openLightbox(imageSrc) {
        if (!lightbox || !lightboxImg) return;

        lightboxImg.src = imageSrc;
        lightbox.classList.remove("hidden");
        // Small delay to allow display:block to apply before opacity transition
        setTimeout(() => {
            lightbox.classList.remove("opacity-0");
        }, 10);

        document.body.style.overflow = "hidden"; // Prevent scrolling
    }

    function closeLightbox() {
        if (!lightbox) return;

        lightbox.classList.add("opacity-0");

        setTimeout(() => {
            lightbox.classList.add("hidden");
            if (lightboxImg) lightboxImg.src = "";
        }, 300); // Match transition duration

        document.body.style.overflow = ""; // Restore scrolling
    }

    // Close on Escape key
    document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
            closeLightbox();
        }
    });
</script>
